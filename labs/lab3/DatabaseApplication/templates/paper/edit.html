<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>修改论文信息</title>
        <link href="../../static/css/bootstrap.css" rel="stylesheet" />
        <style>
            body {
                background: url("../../static/img/background.jpg") no-repeat
                    center center fixed;
                -webkit-background-size: cover;
                -moz-background-size: cover;
                -o-background-size: cover;
                background-size: cover;
            }
            .container.header {
                background: linear-gradient(to bottom, rgba(62, 78, 80, 0.8), rgba(62, 78, 80, 0.08)); /* 设置背景颜色为从左到右的渐变 */
                padding: 5px; /* 设置内边距 */
                width: 100%; /* 设置宽度为100% */
            }
            .container.top {
                /* 为新的类添加样式 */
                height: 100px; /* 设置高度为视口的高度 */
                border-radius: 5px; /* 设置边框圆角 */
                margin-top: 20px; /* 设置上外边距 */
                display: flex; /* 使用flex布局 */
                justify-content: center; /* 水平居中 */
                align-items: center; /* 垂直居中 */
                background-color: #f8f9fac0;
            }
            .container.info {
                background-color: #f8f9fac0;
                border-radius: 5px; /* 设置边框圆角 */
                padding: 10px; /* 设置内边距 */
                margin-top: 20px;
                align-items: center; /* 垂直居中 */
                display: flex; /* 使用flex布局 */
                height: auto;
            }
            .nav {
                background-color: #f8f9fa00; /* 设置背景颜色为浅灰色 */
                border-radius: 5px; /* 设置边框圆角 */
                /* padding: 20px; /* 设置内边距 */
                /* width: 100%; /* 设置宽度为100% */
                width: 95%;
            }
            .container.query {
                background-color: #f8f9fac0;
                border-radius: 5px; /* 设置边框圆角 */
                padding: 20px; /* 设置内边距 */
                margin-top: 20px;
            }
            input {
                margin-right: 10px;
            }
            .author {
                margin-bottom: 10px;
                margin-top: 10px;
            }
        </style>
    </head>
    <body>
        <a href="/">
            <div class="container header">
                <div class="row">
                    <div class="col-lg-12 text-white text-left py-3">
                        <h4 style="color: rgb(255, 255, 255)">
                            教师教学科研登记系统
                        </h4>
                    </div>
                </div>
            </div>
        </a>
        <div class="container top">
            <!-- 使用container-fluid使内容填满整个页面 -->

            <div class="row">
                <div class="col-lg-12 text-white text-center py-3">
                    <!-- 使用col-lg-12使占据整行，bg-primary为背景颜色为蓝色，text-white为字体颜色为白色，py-3为上下内边距为3 -->
                    <h1 style="color: darkslategrey">修改论文信息</h1>
                </div>
            </div>
        </div>
        <a href="/info/teacher" target="_blank">
            <div class="container info">
                <div class="row">
                    <div class="col-lg-12 text-left">
                        <h4>点击查询教师及课程信息>>></h4>
                    </div>
                </div>
            </div>
        </a>
        <div class="container query">
            <form
                method="POST"
                action="/paper/register"
                style="margin-top: 20px"
                id="register_form"
            >
                <div class="form-group">
                    <input
                        type="text"
                        class="form-control"
                        id="id"
                        name="id"
                        value="{{ paper.id }}"
                        placeholder="序号  空缺则自动分配"
                    />
                </div>
                <div class="form-group">
                    <input
                        type="text"
                        class="form-control"
                        name="title"
                        value="{{ paper.title }}"
                        placeholder="名称"
                        required
                    />
                </div>
                <div class="form-group">
                    <input
                        type="text"
                        class="form-control"
                        name="source"
                        value="{{ paper.source }}"
                        placeholder="发表源"
                        required
                    />
                </div>
                <div class="form-group">
                    <input
                        type="text"
                        class="form-control"
                        id="year"
                        name="year"
                        value="{{ paper.year }}"
                        placeholder="发表年份"
                        required
                    />
                </div>
                <div class="form-group">
                    <label for="type">类型：</label>
                    <div
                        class="form-check form-check-inline"
                        style="display: inline-block"
                    >
                        <input class="form-check-input" type="radio" id="1"
                        name="type" {{ 'checked' if paper.type == 1 else '' }}
                        value="1" required />
                        <label class="form-check-label" for="1"
                            >full paper</label
                        >
                    </div>
                    <div
                        class="form-check form-check-inline"
                        style="display: inline-block"
                    >
                        <input class="form-check-input" type="radio" id="2"
                        name="type" {{ 'checked' if paper.type == 2 else '' }}
                        value="2" required />
                        <label class="form-check-label" for="2"
                            >short paper</label
                        >
                    </div>
                    <div
                        class="form-check form-check-inline"
                        style="display: inline-block"
                    >
                        <input class="form-check-input" type="radio" id="3"
                        name="type" {{ 'checked' if paper.type == 3 else '' }}
                        value="3" required />
                        <label class="form-check-label" for="3"
                            >poster paper</label
                        >
                    </div>
                    <!-- 添加更多的选项 -->
                    <div
                        class="form-check form-check-inline"
                        style="display: inline-block"
                    >
                        <input class="form-check-input" type="radio" id="4"
                        name="type" {{ 'checked' if paper.type == 4 else '' }}
                        value="4" required />
                        <label class="form-check-label" for="4"
                            >demo paper</label
                        >
                    </div>
                </div>
                <div class="form-group">
                    <label for="level">等级：</label>
                    <div
                        class="form-check form-check-inline"
                        style="display: inline-block"
                    >
                        <input class="form-check-input" type="radio" id="1"
                        name="level" {{ 'checked' if paper.level == 1 else '' }}
                        value="1" required />
                        <label class="form-check-label" for="1">CCF-A</label>
                    </div>
                    <div
                        class="form-check form-check-inline"
                        style="display: inline-block"
                    >
                        <input class="form-check-input" type="radio" id="2"
                        name="level" {{ 'checked' if paper.level == 2 else '' }}
                        value="2" required />
                        <label class="form-check-label" for="2">CCF-B</label>
                    </div>
                    <div
                        class="form-check form-check-inline"
                        style="display: inline-block"
                    >
                        <input class="form-check-input" type="radio" id="3"
                        name="level" {{ 'checked' if paper.level == 3 else '' }}
                        value="3" required />
                        <label class="form-check-label" for="3">CCF-C</label>
                    </div>
                    <!-- 添加更多的选项 -->
                    <div
                        class="form-check form-check-inline"
                        style="display: inline-block"
                    >
                        <input class="form-check-input" type="radio" id="4"
                        name="level" {{ 'checked' if paper.level == 4 else '' }}
                        value="4" required />
                        <label class="form-check-label" for="4"
                            >中文 CCF-A</label
                        >
                    </div>
                    <div
                        class="form-check form-check-inline"
                        style="display: inline-block"
                    >
                        <input class="form-check-input" type="radio" id="5"
                        name="level" {{ 'checked' if paper.level == 5 else '' }}
                        value="5" required />
                        <label class="form-check-label" for="5"
                            >中文 CCF-B</label
                        >
                    </div>
                    <div
                        class="form-check form-check-inline"
                        style="display: inline-block"
                    >
                        <input class="form-check-input" type="radio" id="6"
                        name="level" {{ 'checked' if paper.level == 6 else '' }}
                        value="6" required />
                        <label class="form-check-label" for="6">无等级</label>
                    </div>
                </div>
                <div class="form-group">
                    <div id="authorContainer">
                        {% for author in authors %}
                        <div class="author">
                            <label for="author">作者{{ loop.index }}：</label>
                            <input
                                type="text"
                                name="authorId{{ loop.index }}"
                                value="{{ author.id }}"
                                placeholder="工号"
                                required
                            />
                            <input type="radio" name="isCorrespondingAuthor"
                            value="{{ loop.index }}" {% if author.corresponding
                            == 1 %} checked {% endif %} required /> 通讯作者
                        </div>
                        {% endfor %}
                    </div>

                    <button type="button" id="addAuthor">添加作者</button>
                    <button type="button" id="removeAuthor">删除作者</button>
                </div>
                <div class="form-group">
                    <input type="submit" class="btn btn-primary" value="修改" />
                </div>
            </form>
        </div>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="../../static/js/bootstrap.js"></script>
        <script>
            $(document).ready(function () {
                $("#addAuthor").click(function () {
                    var authorHtml =
                        '<div class="author">\n' +
                        '<label for="author">作者' +
                        String($(".author").length + 1) +
                        "：</label>\n" +
                        '<input type="text" name="authorId' +
                        String($(".author").length + 1) +
                        '" placeholder="工号" required>\n' +
                        // '<input type="text" name="authorOrder"' + String($(".author").length + 1) + ' placeholder="序号" required>\n' +
                        '<input type="radio" name="isCorrespondingAuthor" value="' +
                        String($(".author").length + 1) +
                        '" required> 通讯作者\n' +
                        "</div>";

                    $("#authorContainer").append(authorHtml);
                });

                $("#removeAuthor").click(function () {
                    if ($(".author").length > 1) {
                        $(".author").last().remove();
                    }
                });
            });
        </script>
        <script>
            $(document).ready(function () {
                $("#register_form").submit(function (event) {
                    var inputValue = $("#id").val();
                    if (inputValue === "") {
                    } else if (!Number.isInteger(Number(inputValue))) {
                        event.preventDefault(); // 阻止表单的默认提交行为
                        alert("序号必须为整数！");
                        return;
                    }
                    var inputValue = $("#year").val();
                    var curYear = new Date().getFullYear();
                    if (inputValue === "") {
                        return;
                    }
                    if (!Number.isInteger(Number(inputValue))) {
                        event.preventDefault(); // 阻止表单的默认提交行为
                        alert("输入的年份不合法！");
                        return;
                    } else if (
                        Number(inputValue) < 1958 ||
                        Number(inputValue) > curYear
                    ) {
                        event.preventDefault(); // 阻止表单的默认提交行为
                        alert("输入的年份不合法！");
                        return;
                    }
                    event.preventDefault(); // 阻止表单的默认提交行为
                    var currentUrl = window.location.href;

                    $.ajax({
                        url: currentUrl, // 请求的 URL
                        type: "POST", // 请求的方法
                        data: $(this).serialize(), // 表单数据
                        success: function (response) {
                            // 处理响应
                            alert(response.message);
                            if (
                                response.message ===
                                "修改成功！点击确定关闭页面。"
                            ) {
                                window.close();
                            }
                        },
                    });
                });
            });
        </script>
        <script>
            document.getElementById("register_form").action =
                window.location.href;
        </script>
    </body>
</html>
