<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>登记承担项目情况</title>
        <link href="../static/css/bootstrap.css" rel="stylesheet" />

        <style>
            body {
                background: url("../static/img/background.jpg") no-repeat center
                    center fixed;
                -webkit-background-size: cover;
                -moz-background-size: cover;
                -o-background-size: cover;
                background-size: cover;
            }
            .container.header {
                background: linear-gradient(to bottom, rgba(62, 78, 80, 0.8), rgba(62, 78, 80, 0.08)); /* 设置背景颜色为从左到右的渐变 */
                padding: 5px; /* 设置内边距 */
                width: 100%; /* 设置宽度为100% */
            }
            .container.top {
                /* 为新的类添加样式 */
                height: 100px; /* 设置高度为视口的高度 */
                border-radius: 5px; /* 设置边框圆角 */
                margin-top: 20px; /* 设置上外边距 */
                display: flex; /* 使用flex布局 */
                justify-content: center; /* 水平居中 */
                align-items: center; /* 垂直居中 */
                background-color: #f8f9fac0;
            }
            .container.info {
                background-color: #f8f9fac0;
                border-radius: 5px; /* 设置边框圆角 */
                padding: 10px; /* 设置内边距 */
                margin-top: 20px;
                align-items: center; /* 垂直居中 */
                display: flex; /* 使用flex布局 */
                height: auto;
            }
            .nav {
                background-color: #f8f9fa00; /* 设置背景颜色为浅灰色 */
                border-radius: 5px; /* 设置边框圆角 */
                /* padding: 20px; /* 设置内边距 */
                /* width: 100%; /* 设置宽度为100% */
                width: 95%;
            }
            .container.query {
                background-color: #f8f9fac0;
                border-radius: 5px; /* 设置边框圆角 */
                padding: 20px; /* 设置内边距 */
                margin-top: 20px;
            }
            .container.result {
                background-color: #f8f9fac0;
                border-radius: 5px; /* 设置边框圆角 */
                padding: 20px; /* 设置内边距 */
                margin-top: 20px;
            }
        </style>
    </head>
    <body>
        <a href="/">
            <div class="container header">
                <div class="row">
                    <div class="col-lg-12 text-white text-left py-3">
                        <h4 style="color: rgb(255, 255, 255)">
                            教师教学科研登记系统
                        </h4>
                    </div>
                </div>
            </div>
        </a>
        <div class="container top">
            <!-- 使用container-fluid使内容填满整个页面 -->

            <div class="row">
                <div class="col-lg-12 text-white text-center py-3">
                    <!-- 使用col-lg-12使占据整行，bg-primary为背景颜色为蓝色，text-white为字体颜色为白色，py-3为上下内边距为3 -->
                    <h1 style="color: darkslategrey">承担项目情况</h1>
                </div>
            </div>
        </div>
        <a href="/info/teacher" target="_blank">
            <div class="container info">
                <div class="row">
                    <div class="col-lg-12 text-left">
                        <h4>点击查询教师及课程信息>>></h4>
                    </div>
                </div>
            </div>
        </a>
        <div class="container query">
            <div class="container" role="navigation">
                <ul class="nav nav-tabs">
                    <li role="presentation" class="active">
                        <a href="#">查询</a>
                    </li>
                    <li role="presentation">
                        <a href="project/register">登记</a>
                    </li>
                </ul>
            </div>

            <form
                method="POST"
                action="/project"
                style="margin-top: 20px"
                id="query_form"
            >
                <div class="form-group">
                    <input
                        type="text"
                        class="form-control"
                        id="id"
                        name="id"
                        value="{{query.id}}"
                        placeholder="项目号"
                    />
                </div>
                <div class="form-group">
                    <input
                        type="text"
                        class="form-control"
                        id="name"
                        name="name"
                        value="{{query.name}}"
                        placeholder="项目名称"
                    />
                </div>
                <div class="form-group">
                    <input
                        type="text"
                        class="form-control"
                        id="source"
                        name="source"
                        value="{{query.source}}"
                        placeholder="项目来源"
                    />
                </div>
                <div class="form-group">
                    <label for="type">项目类型：</label>
                    <div
                        class="form-check form-check-inline"
                        style="display: inline-block"
                    >
                        <input class="form-check-input" type="checkbox" id="1"
                        name="type" {{ "checked" if '1' in query.type }}
                        value="1" />
                        <label class="form-check-label" for="1"
                            >国家级项目</label
                        >
                    </div>
                    <div
                        class="form-check form-check-inline"
                        style="display: inline-block"
                    >
                        <input class="form-check-input" type="checkbox" id="2"
                        name="type" {{ "checked" if '2' in query.type }}
                        value="2" />
                        <label class="form-check-label" for="2"
                            >省部级项目</label
                        >
                    </div>
                    <div
                        class="form-check form-check-inline"
                        style="display: inline-block"
                    >
                        <input class="form-check-input" type="checkbox" id="3"
                        name="type" {{ "checked" if '3' in query.type }}
                        value="3" />
                        <label class="form-check-label" for="3"
                            >市厅级项目</label
                        >
                    </div>
                    <!-- 添加更多的选项 -->
                    <div
                        class="form-check form-check-inline"
                        style="display: inline-block"
                    >
                        <input class="form-check-input" type="checkbox" id="4"
                        name="type" {{ "checked" if '4' in query.type }}
                        value="4" />
                        <label class="form-check-label" for="4"
                            >企业合作项目</label
                        >
                    </div>
                    <div
                        class="form-check form-check-inline"
                        style="display: inline-block"
                    >
                        <input class="form-check-input" type="checkbox" id="5"
                        name="type" {{ "checked" if '5' in query.type }}
                        value="5" />
                        <label class="form-check-label" for="5"
                            >其他类型项目</label
                        >
                    </div>
                </div>
                <div class="form-group">
                    <input
                        type="text"
                        class="form-control"
                        id="funds"
                        name="funds"
                        value="{{query.funds}}"
                        placeholder="总经费(元)"
                    />
                </div>
                <div class="form-group">
                    <input
                        type="number"
                        class="form-control"
                        id="begin_year"
                        name="begin_year"
                        value="{{query.begin_year}}"
                        placeholder="开始年份"
                    />
                </div>
                <div class="form-group">
                    <input
                        type="number"
                        class="form-control"
                        id="end_year"
                        name="end_year"
                        value="{{query.end_year}}"
                        placeholder="结束年份"
                    />
                </div>
                <div class="form-group">
                    <input
                        type="text"
                        class="form-control"
                        id="leader_id"
                        name="leader_id"
                        value="{{query.leader_id}}"
                        placeholder="项目负责人工号或姓名"
                    />
                </div>
                <div class="form-group">
                    <input type="submit" class="btn btn-primary" value="查询" />
                </div>
            </form>
        </div>
        <div class="container result">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th scope="col">项目号</th>
                        <th scope="col">项目名称</th>
                        <th scope="col">项目来源</th>
                        <!-- 其他列... -->
                        <th scope="col">项目类型</th>
                        <th scope="col">总经费</th>
                        <th scope="col">开始年份</th>
                        <th scope="col">结束年份</th>
                        <th scope="col">项目负责人</th>
                        <th scope="col">操作</th>
                    </tr>
                </thead>
                <tbody>
                    {% if projects is none %}
                    <tr>
                        <td colspan="9" class="text-center">无结果</td>
                    </tr>
                    {% else %} {% for project in projects %}
                    <tr>
                        <td>{{ project.id }}</td>
                        <td>{{ project.name }}</td>
                        <td>{{ project.source }}</td>
                        <!-- 其他列... -->
                        <td>{{ project.type }}</td>
                        <td>{{ project.funds }}元</td>
                        <td>{{ project.begin_year }}</td>
                        <td>{{ project.end_year }}</td>
                        <td>{{ project.leaders }}</td>
                        <td>
                            <a
                                href="/project/{{ project.id }}/view"
                                target="_blank"
                                class="btn btn-primary"
                                >查看</a
                            >
                            <a
                                href="/project/{{ project.id }}/edit"
                                target="_blank"
                                class="btn btn-secondary"
                                >编辑</a
                            >
                            <a
                                href="/project/{{ project.id }}/delete"
                                target="_blank"
                                class="btn btn-danger"
                                >删除</a
                            >
                        </td>
                    </tr>
                    {% endfor %} {% endif %}
                </tbody>
            </table>
        </div>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="../static/js/bootstrap.js"></script>
        <script>
            $(document).ready(function () {
                $("#query_form").submit(function (event) {
                    var inputFunds = $("#funds").val();
                    console.log(inputFunds);
                    if (inputFunds !== "" && Number.isNaN(Number(inputFunds))) {
                        event.preventDefault(); // 阻止表单的默认提交行为
                        alert("总经费必须为数字！");
                        return;
                    }

                    // 其他代码...
                    var inputYear = $("#begin_year").val();
                    var curYear = new Date().getFullYear();
                    if (inputYear !== "") {
                        if (!Number.isInteger(Number(inputYear))) {
                            event.preventDefault(); // 阻止表单的默认提交行为
                            alert("开始年份必须为整数！");
                            return;
                        } else if (
                            Number(inputYear) < 1958 ||
                            Number(inputYear) > curYear
                        ) {
                            event.preventDefault(); // 阻止表单的默认提交行为
                            alert("开始年份不合法！");
                            return;
                        }
                    }
                    var inputYear = $("#end_year").val();
                    var curYear = new Date().getFullYear();
                    if (inputYear === "") {
                    } else if (!Number.isInteger(Number(inputYear))) {
                        event.preventDefault(); // 阻止表单的默认提交行为
                        alert("结束年份必须为整数！");
                        return;
                    } else if (
                        Number(inputYear) < 1958
                    ) {
                        event.preventDefault(); // 阻止表单的默认提交行为
                        alert("结束年份不合法！");
                        return;
                    }
                });
            });
        </script>
        <script>
            $(document).ready(function () {
                $(".btn-danger").click(function (event) {
                    event.preventDefault(); // 阻止默认的点击行为
                    var url = $(this).attr("href"); // 获取链接的URL
                    var row = $(this).closest("tr"); // 获取按钮所在的表格行
                    $.ajax({
                        url: url,
                        type: "DELETE",
                        success: function (result) {
                            // 在这里处理服务器返回的结果
                            alert(result.message); // 弹出提示信息
                            if (result.message == "删除成功！") row.remove(); // 删除表格行
                        },
                    });
                });
            });
        </script>
    </body>
</html>
